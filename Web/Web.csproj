<Project Sdk="Microsoft.NET.Sdk.Web">

  <PropertyGroup>
    <TargetFramework>netcoreapp2.0</TargetFramework>
    <RuntimeIdentifier>win7-x86</RuntimeIdentifier>
    <AssemblyName>Havit.NewProjectTemplate.Web</AssemblyName>
    <RootNamespace>Havit.NewProjectTemplate.Web</RootNamespace>
	<GenerateAssemblyInfo>false</GenerateAssemblyInfo>
	<TypeScriptCompileBlocked>true</TypeScriptCompileBlocked>
	<TypeScriptToolsVersion>Latest</TypeScriptToolsVersion>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Debug|AnyCPU'">
    <NoWarn>1701;1702;NU1701</NoWarn>
  </PropertyGroup>

  <PropertyGroup Condition="'$(Configuration)|$(Platform)'=='Release|AnyCPU'">
    <NoWarn>1701;1702;NU1701</NoWarn>
  </PropertyGroup>

  <ItemGroup>
    <None Remove="ClientApp\components\HelloWorld.tsx" />
  </ItemGroup>

  <ItemGroup>
    <Compile Include="..\CommonAssemblyInfo.cs" Link="Properties\CommonAssemblyInfo.cs" />
	<RazorCompile Include="..\CommonAssemblyInfo.cs" />
  </ItemGroup>
  <ItemGroup>
	<DotNetCliToolReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Tools" Version="2.0.0" />
  </ItemGroup>
  
  <ItemGroup>
    <PackageReference Include="Havit.AspNetCore.Mvc" Version="1.8.0" />
    <PackageReference Include="Microsoft.ApplicationInsights.AspNetCore" Version="2.4.1" />
    <PackageReference Include="Microsoft.AspNetCore" Version="2.1.3" />
    <PackageReference Include="Microsoft.AspNetCore.Mvc" Version="2.1.2" />
    <PackageReference Include="Microsoft.AspNetCore.SpaServices" Version="2.1.1" />
    <PackageReference Include="Microsoft.AspNetCore.StaticFiles" Version="2.1.1" />
    <PackageReference Include="Microsoft.Extensions.Logging.EventLog" Version="2.1.1" />
    <PackageReference Include="Microsoft.VisualStudio.Web.BrowserLink" Version="2.1.1" />
    <PackageReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Design" Version="2.1.3" />
	<PackageReference Include="TypeLite.Lib" Version="1.8.4" NoWarn="NU1701" />
	<PackageReference Include="Yarn.MSBuild" Version="1.7.0" />
  </ItemGroup>
  
  <ItemGroup>
    <TypeScriptCompile Include="ClientApp\components\HelloWorld.tsx" />
  </ItemGroup>

  <Target Name="Yarn" BeforeTargets="Build">
	<Yarn />
	<Yarn Command="run build:dev" Condition="'$(Configuration)' == 'Debug'" />
	<Yarn Command="run build:prod" Condition="'$(Configuration)' != 'Debug'" />
  </Target>
    
  <Target Name="PublishRunWebpack" AfterTargets="ComputeFilesToPublish">
    <!-- Include the built files in the publish output -->
	<ItemGroup>
	  <DistFiles Include="wwwroot\dist\**; ClientApp\dist\**" />
	  <ResolvedFileToPublish Include="@(DistFiles->'%(FullPath)')" Exclude="@(ResolvedFileToPublish)">
		<RelativePath>%(DistFiles.Identity)</RelativePath>
		<CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
	  </ResolvedFileToPublish>
	</ItemGroup>
  </Target>

  <Target Name="TfsPublish" AfterTargets="AfterPublish" Condition="'$(PublishDirectory)' != ''">
    <ItemGroup>
      <WebToCopy Include="obj\Release\TfsPublish\**\*.*" />
      <WebToCopy Remove="obj\Release\TfsPublish\Config\*.*" />
    </ItemGroup>
    <Copy SourceFiles="@(WebToCopy)" DestinationFiles="@(WebToCopy->'$(PublishDirectory)\Web\%(RecursiveDir)%(Filename)%(Extension)')" />
  </Target>

</Project>
